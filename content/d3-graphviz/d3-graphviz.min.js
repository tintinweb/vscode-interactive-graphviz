!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection"),require("d3-dispatch"),require("d3-transition"),require("d3-timer"),require("d3-interpolate"),require("d3-zoom"),require("@hpcc-js/wasm"),require("d3-format"),require("d3-path")):"function"==typeof define&&define.amd?define(["exports","d3-selection","d3-dispatch","d3-transition","d3-timer","d3-interpolate","d3-zoom","@hpcc-js/wasm","d3-format","d3-path"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["d3-graphviz"]={},t.d3,t.d3,t.d3,t.d3,t.d3,t.d3,t["@hpcc-js/wasm"],t.d3,t.d3)}(this,(function(t,e,n,i,r,a,o,s,l,h){"use strict";function c(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}var u,d=c(e);function f(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function p(t){return function(t){if(Array.isArray(t))return g(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function v(t){var e={},n=t.node().nodeName;e.tag=n,"#text"==n?e.text=t.text():"#comment"==n&&(e.comment=t.text()),e.attributes={};var i=t.node().attributes;if(i)for(var r=0;r<i.length;r++){var a=i[r],o=a.name,s=a.value;e.attributes[o]=s}var l=t.node().transform;if(l&&0!=l.baseVal.numberOfItems){var h=l.baseVal.consolidate().matrix;e.translation={x:h.e,y:h.f},e.scale=h.a}if("ellipse"==n&&(e.center={x:e.attributes.cx,y:e.attributes.cy}),"polygon"==n){var c=(g=t.attr("points").split(" ")).map((function(t){return t.split(",")[0]})),u=g.map((function(t){return t.split(",")[1]})),d=Math.min.apply(null,c),f=Math.max.apply(null,c),p={x:d,y:v=Math.min.apply(null,u),width:f-d,height:(y=Math.max.apply(null,u))-v};e.bbox=p,e.center={x:(d+f)/2,y:(v+y)/2}}if("path"==n){var g;(g=t.attr("d").split(/[A-Z ]/)).shift();var v,y;c=g.map((function(t){return+t.split(",")[0]})),u=g.map((function(t){return+t.split(",")[1]})),d=Math.min.apply(null,c),f=Math.max.apply(null,c),p={x:d,y:v=Math.min.apply(null,u),width:f-d,height:(y=Math.max.apply(null,u))-v};e.bbox=p,e.center={x:(d+f)/2,y:(v+y)/2},e.totalLength=t.node().getTotalLength()}return"text"==n&&(e.center={x:t.attr("x"),y:t.attr("y")}),"#text"==n?e.text=t.text():"#comment"==n&&(e.comment=t.text()),e}function y(t){var e=v(t);return e.children=[],d.selectAll(t.node().childNodes).each((function(){var t=y(d.select(this));t.parent=e,e.children.push(t)})),e}function _(t){return"#text"==t.tag?document.createTextNode(""):"#comment"==t.tag?document.createComment(t.comment):document.createElementNS("http://www.w3.org/2000/svg",t.tag)}function m(t){for(var e=_(t),n=d.select(e),i=t.attributes,r=0,a=Object.keys(i);r<a.length;r++){var o=a[r],s=i[o];n.attr(o,s)}return e}function w(t,e){var n=d.select(t.node().parentNode),i=m(e),r=n.insert((function(){return i}),(function(){return t.node()}));return t.remove(),r}function x(t,e){!function(t,e){t.datum(e),t.data([e],(function(t){return t.key}))}(t,e),d.selectAll(t.node().childNodes).each((function(t,n){x(d.select(this),e.children[n])}))}function b(t,e){var n=t.selectAll((function(){return t.node().childNodes})),i=(n=n.data((function(t){return t.children}),(function(t){return t.tag+"-"+e}))).enter().append((function(t){return _(t)})),r=n.exit();r=r.remove(),n=i.merge(n);var a={};n.each((function(t){var e=t.tag;null==a[e]&&(a[e]=0);var n=a[e]++;E.call(this,t,n)}))}function E(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=d.select(this);t.tag;var i=t.attributes,r=n.node().attributes;if(r)for(var a=0;a<r.length;a++){var o=r[a],s=o.name;if("xmlns"!=s.split(":")[0]&&o.namespaceURI){var l=o.namespaceURI.split("/"),h=l[l.length-1];s=h+":"+s}s in i||(i[s]=null)}for(var c=0,u=Object.keys(i);c<u.length;c++){var f=u[c];n.attr(f,i[f])}t.text&&n.text(t.text),b(n,e)}function k(t){return Object.assign({},t)}function P(t){return Math.round(100*t)/100}function z(){var t=this;var e=this._selection,n=d.select(e.node().querySelector("svg"));if(0==n.size())return this;this._zoomSelection=n;var i=o.zoom().scaleExtent(this._options.zoomScaleExtent).translateExtent(this._options.zoomTranslateExtent).interpolate(a.interpolate).on("zoom",(function(e){d.select(n.node().querySelector("g")).attr("transform",e.transform),t._dispatch.call("zoom",t)}));this._zoomBehavior=i;var r=d.select(n.node().querySelector("g"));return n.call(i),this._active||N.call(this,r),this._originalTransform=o.zoomTransform(n.node()),this}function S(t){var e=this._translation,n=this._scale,i=t.datum().translation,r=t.datum().scale,a=o.zoomTransform(this._zoomSelection.node());return e&&(a=(a=a.scale(1/n)).translate(-e.x,-e.y)),a=(a=a.translate(i.x,i.y)).scale(r)}function N(t){this._zoomBehavior.transform(this._zoomSelection,S.call(this,t)),this._translation=t.datum().translation,this._scale=t.datum().scale,this._originalTransform=o.zoomIdentity.translate(t.datum().translation.x,t.datum().translation.y).scale(t.datum().scale)}function D(t,e){return function(){var n=t.map((function(t){return a.interpolate([t[0][0],t[0][1]],[t[1][0],t[1][1]])}));return function(t){return t<1?"M"+n.map((function(e){return e(t)})).join("L"):e}}}function j(t){return"edge"==t.attributes.class||"a"==t.tag&&"g"==t.parent.tag&&"edge"==t.parent.parent.attributes.class}function M(t){return t.parent&&j(t.parent)}function W(t){var e=this._transition,n=this._options.fade&&null!=e,i=this._options.tweenPaths,r=this._options.tweenShapes,s=this._options.convertEqualSidedPolygons,l=this._options.growEnteringEdges&&null!=e,h=this._attributer,c=this;function u(t){var f=d.select(this);if("svg"==t.tag){var p=c._options;if(null!=p.width||null!=p.height){var g=p.width,y=p.height;null==g?g=4*t.attributes.width.replace("pt","")/3:(f.attr("width",g),t.attributes.width=g),null==y?y=4*t.attributes.height.replace("pt","")/3:(f.attr("height",y),t.attributes.height=y),p.fit||(f.attr("viewBox","0 0 ".concat(3*g/4/p.scale," ").concat(3*y/4/p.scale)),t.attributes.viewBox="0 0 ".concat(3*g/4/p.scale," ").concat(3*y/4/p.scale))}1!=p.scale&&(p.fit||null==p.width&&null==p.height)&&(g=t.attributes.viewBox.split(" ")[2],y=t.attributes.viewBox.split(" ")[3],f.attr("viewBox","0 0 ".concat(g/p.scale," ").concat(y/p.scale)),t.attributes.viewBox="0 0 ".concat(g/p.scale," ").concat(y/p.scale))}h&&f.each(h);var m=t.tag,x=t.attributes,b=f.node().attributes;if(b)for(var E=0;E<b.length;E++){var k=b[E],P=k.name;if("xmlns"!=P.split(":")[0]&&k.namespaceURI){var z=k.namespaceURI.split("/");P=z[z.length-1]+":"+P}P in x||(x[P]=null)}var W=!1,O=!1;if(r&&e){if("polygon"!=this.nodeName&&"ellipse"!=this.nodeName||!t.alternativeOld||(O=!0),"polygon"!=m&&"ellipse"!=m||!t.alternativeNew||(W=!0),"polygon"==this.nodeName&&"polygon"==m&&t.alternativeOld){var L=v(f).attributes.points;if(!s){var A=L.split(" ").length;(X=t.attributes.points).split(" ").length==A&&(W=!1,O=!1)}}if(O){var T=t.alternativeOld,q=w(f,T);q.data([t],(function(){return t.key})),f=q}if(W)m="path",x=t.alternativeNew.attributes}var I=f;if(e&&(I=I.transition(e),n&&I.filter((function(t){return"#"==t.tag[0]?null:this})).style("opacity",1),I.filter((function(t){return"#"==t.tag[0]?null:this})).on("end",(function(t){d.select(this).attr("style",t&&t.attributes&&t.attributes.style||null)}))),l&&"path"==m&&t.offset){var B=t.totalLength;f.attr("stroke-dasharray",B+" "+B).attr("stroke-dashoffset",B).attr("transform","translate("+t.offset.x+","+t.offset.y+")"),x["stroke-dashoffset"]=0,x.transform="translate(0,0)",I.attr("stroke-dashoffset",x["stroke-dashoffset"]).attr("transform",x.transform).on("start",(function(){d.select(this).style("opacity",null)})).on("end",(function(){d.select(this).attr("stroke-dashoffset",null).attr("stroke-dasharray",null).attr("transform",null)}))}if(l&&"polygon"==m&&M(t)&&t.offset&&"path"==t.parent.children[3].tag){var U=d.select(f.node().parentNode.querySelector("path")),R=U.node().getPointAtLength(0),F=U.node().getPointAtLength(t.totalLength),C=U.node().getPointAtLength(t.totalLength-1),V=180*Math.atan2(F.y-C.y,F.x-C.x)/Math.PI,Z=R.x-F.x+t.offset.x,$=R.y-F.y+t.offset.y;f.attr("transform","translate("+Z+","+$+")"),I.attrTween("transform",(function(){return function(e){var n=U.node().getPointAtLength(t.totalLength*e),i=U.node().getPointAtLength(t.totalLength*e+1),r=180*Math.atan2(i.y-n.y,i.x-n.x)/Math.PI-V;return Z=n.x-F.x+t.offset.x*(1-e),$=n.y-F.y+t.offset.y*(1-e),"translate("+Z+","+$+") rotate("+r+" "+F.x+" "+F.y+")"}})).on("start",(function(){d.select(this).style("opacity",null)})).on("end",(function(){d.select(this).attr("transform",null)}))}for(var G=i&&e&&"path"==m&&null!=f.attr("d"),H=0,J=Object.keys(x);H<J.length;H++){var K=J[H],Q=x[K];if(G&&"d"==K){var X;(X=(t.alternativeOld||t).points)&&I.attrTween("d",D(X,Q))}else{if("transform"==K&&t.translation)if(e){var Y=I.on("end");I.on("start",(function(){c._zoomBehavior&&I.tween("attr.transform",(function(){var t=this;return function(e){t.setAttribute("transform",a.interpolateTransformSvg(o.zoomTransform(c._zoomSelection.node()).toString(),S.call(c,f).toString())(e))}}))})).on("end",(function(){Y.call(this),c._zoomBehavior&&N.call(c,f)}))}else c._zoomBehavior&&(N.call(c,f),Q=S.call(c,f).toString());I.attr(K,Q)}}W&&I.on("end",(function(t,e,n){w(q=d.select(this),t).data([t],(function(){return t.key}))})),t.text&&I.text(t.text),function(t){var i=t.selectAll((function(){return t.node().childNodes})),r=(i=i.data((function(t){return t.children}),(function(t){return t.key}))).enter().append((function(t){var e=_(t);return"#text"==t.tag&&n&&(e.nodeValue=t.text),e}));(n||l&&j(t.datum()))&&r.filter((function(t){return"#"==t.tag[0]?null:this})).each((function(t){for(var e=d.select(this),n=0,i=Object.keys(t.attributes);n<i.length;n++){var r=i[n],a=t.attributes[r];e.attr(r,a)}})).filter((function(t){return"svg"==t.tag||"g"==t.tag?null:this})).style("opacity",0);var a=i.exit();h&&a.each(h),e&&(a=a.transition(e),n&&a.filter((function(t){return"#"==t.tag[0]?null:this})).style("opacity",0)),a=a.remove(),(i=r.merge(i)).each(u)}(f)}var f=this._selection;if(null!=e){var p=this._jobs;if(c._active)return p.push(null),this;f.transition(e).transition().duration(0).on("end",(function(){c._active=!1,0!=p.length&&(p.shift(),c.render())})),this._active=!0}null!=e&&f.transition(e).on("start",(function(){c._dispatch.call("transitionStart",c)})).on("end",(function(){c._dispatch.call("transitionEnd",c)})).transition().duration(0).on("start",(function(){c._dispatch.call("restoreEnd",c),c._dispatch.call("end",c),t&&t.call(c)}));var g=this._data,y=f.selectAll("svg").data([g],(function(t){return t.key}));return y=y.enter().append("svg").merge(y),u.call(y.node(),g),this._options.zoom&&!this._zoomBehavior&&z.call(this),c._dispatch.call("renderEnd",c),null==e&&(this._dispatch.call("end",this),t&&t.call(this)),this}function O(t,e){if("polygon"==t.tag){(u=k(t)).tag="path";var n=k(d=t.attributes),i=d.points;if("polygon"==e.tag){(y=t.bbox).cx=y.x+y.width/2,y.cy=y.y+y.height/2;for(var r=d.points.split(" "),a=r.map((function(t){var e=t.split(",");return[e[0]-y.cx,e[1]-y.cy]})),o=a[a.length-1][0],s=a[a.length-1][1],l=0;l<a.length;l++,o=z,s=S){var h=(z=a[l][0])-o;if(0!=(x=(S=a[l][1])-s))if(0<=(N=o-s*h/x)&&N<1/0&&(o<=N&&N<=z||z<=N&&N<=o))break}var c=[[y.cx+N,y.cy+0].join(",")];i=(c=(c=c.concat(r.slice(l))).concat(r.slice(0,l))).join(" ")}n.d="M"+i+"z",delete n.points,u.attributes=n}else{var u;(u=k(t)).tag="path";n=k(d=t.attributes);var d,f=d.cx,p=d.cy,g=d.rx,v=d.ry;if("polygon"==e.tag){var y;(y=e.bbox).cx=y.x+y.width/2,y.cy=y.y+y.height/2;var _=e.attributes.points.split(" ")[0].split(","),m=_[0],w=_[1],x=(h=m-y.cx,w-y.cy),b=Math.sqrt(Math.pow(h,2)+Math.pow(x,2)),E=h/b,P=-x/b}else E=1,P=0;var z,S,N;h=(N=g*-E)-(z=g*E),x=-v*-P-(S=-v*P);n.d="M "+f+" "+p+" m "+z+","+S+" a "+g+","+v+" 0 1,0 "+h+","+x+" a "+g+","+v+" 0 1,0 "+-h+","+-x+"z",delete n.cx,delete n.cy,delete n.rx,delete n.ry,u.attributes=n}return u}function L(){var t=this;try{s.graphviz.layout("","svg","dot").then((function(){s.graphvizSync().then((function(e){t.layoutSync=e.layout.bind(e),null==t._worker&&t._dispatch.call("initEnd",t),t._afterInit&&t._afterInit()}))}))}catch(t){}if(null!=this._worker){var e=this._vizURL,n=this;this._workerPort.onmessage=function(t){n._workerCallbacks.shift().call(n,t)},e.match(/^https?:\/\/|^\/\//i)||(e=new window.URL(e,document.location.href).href),A.call(this,{type:"layout",dot:"",engine:"dot",vizURL:e},(function(t){t.data.type})),A.call(this,{type:"version"},(function(t){if("version"===t.data.type)n._graphvizVersion=t.data.version,n._dispatch.call("initEnd",this)}))}}function A(t,e){this._workerCallbacks.push(e),this._workerPort.postMessage(t)}function T(t,e){var n=this._options.keyMode,i=this._options.tweenPaths,r=this._options.tweenShapes;if("string"==typeof this._options.tweenPrecision&&this._options.tweenPrecision.includes("%"))var a=+this._options.tweenPrecision.split("%")[0]/100,o=this._options.tweenPrecision.includes("%");else a=this._options.tweenPrecision,o=!1;var s=this._options.growEnteringEdges,l={},h=this._dictionary||{},c={},u=this._nodeDictionary||{};function f(t,e){var i=t.tag;if("index"==n)t.key=e;else if("#"!=i[0])if("id"==n)t.key=t.attributes.id;else if("title"==n){var a=t.children.find((function(t){return"title"==t.tag}));a&&(a.children.length>0?t.key=a.children[0].text:t.key="")}null==t.key&&(r&&("ellipse"!=i&&"polygon"!=i||(i="path")),t.key=i+"-"+e)}function p(t,e){var n=(e?e.id+".":"")+t.key;t.id=n}function g(t){l[t.id]=t}function v(t,e){r&&t.id in h&&("polygon"!=e.tag&&"ellipse"!=e.tag&&"path"!=e.tag||e.tag==t.tag&&"polygon"!=t.tag||("path"!=e.tag&&(t.alternativeOld=O(e,t)),"path"!=t.tag&&(t.alternativeNew=O(t,e))))}function _(t,e){if(i&&e&&("path"==e.tag||t.alternativeOld&&"path"==t.alternativeOld.tag)){var n=(t.alternativeNew||t).attributes.d;if(t.alternativeOld)var r=m(t.alternativeOld);else r=m(e);(t.alternativeOld||(t.alternativeOld={})).points=function(t,e,n,i){for(var r=t,a=r.cloneNode(),o=r.getTotalLength(),s=(a.setAttribute("d",e),a).getTotalLength(),l=[0],h=0,c=i?n:n/Math.max(o,s);(h+=c)<1;)l.push(h);return l.push(1),l.map((function(t){var e=r.getPointAtLength(t*o),n=a.getPointAtLength(t*s);return[[e.x,e.y],[n.x,n.y]]}))}(r,n,a,o)}}function w(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;f(t,e),p(t,n);var i=t.id,r=h[i];g(t),v(t,r),_(t,r);var a={};t.children.forEach((function(e){var n=e.tag;"ellipse"!=n&&"polygon"!=n||(n="path"),null==a[n]&&(a[n]=0),w(e,a[n]++,t)}))}function x(t){!function(t){var e=t.tag;if(s&&t.parent&&"node"==t.parent.attributes.class&&"title"==e){if(t.children.length>0)var n=t.children[0].text;else n="";c[n]=t.parent}}(t),function(t){var e=t.id,n=t.tag,i=h[e];if(s&&!i&&t.parent&&M(t)&&("path"==n||"polygon"==n)){if("polygon"==n){var r=t.parent.children.find((function(t){return"path"==t.tag}));r&&(t.totalLength=r.totalLength)}var a=function(t){return function(t){return"edge"==t.parent.attributes.class?t.parent:t.parent.parent.parent}(t).children.find((function(t){return"title"==t.tag}))}(t),o=a.children[0],l=o.text.split("->");2!=l.length&&(l=o.text.split("--"));var d=l[0],f=c[d],p=u[d];if(p){if((y=f.children.findIndex((function(t,e){return"g"==t.tag})))>=0){var g=f.children[y].children.findIndex((function(t,e){return"a"==t.tag}));f=f.children[y].children[g]}(y=p.children.findIndex((function(t,e){return"g"==t.tag})))>=0&&(g=p.children[y].children.findIndex((function(t,e){return"a"==t.tag})),p=p.children[y].children[g]);for(var v=f.children,y=0;y<v.length;y++)if("polygon"==v[y].tag||"ellipse"==v[y].tag||"path"==v[y].tag||"text"==v[y].tag){var _=v[y];break}var m=p.children;for(y=0;y<m.length;y++)if("polygon"==m[y].tag||"ellipse"==m[y].tag||"path"==m[y].tag||"text"==m[y].tag){var w=m[y];break}t.offset=w&&_?{x:w.center.x-_.center.x,y:w.center.y-_.center.y}:{x:0,y:0}}}}(t),t.children.forEach((function(t){x(t)}))}this._dispatch.call("layoutEnd",this);var b=d.select(document.createDocumentFragment()).append("div"),E=(new window.DOMParser).parseFromString(t,"image/svg+xml");b.append((function(){return E.documentElement}));var k=y(b.select("svg"));(this._dispatch.call("dataExtractEnd",this),w(k),this._dispatch.call("dataProcessPass1End",this),x(k),this._dispatch.call("dataProcessPass2End",this),this._data=k,this._dictionary=l,this._nodeDictionary=c,this._extractData=function(t,e,n){var i=y(t);return w(i,e,n),x(i),i},this._busy=!1,this._dispatch.call("dataProcessEnd",this),e&&e.call(this),this._queue.length>0)&&this._queue.shift().call(this)}function q(t,e,n,i){var r=[t*n-(e=-e)*(i=-i),t*i+e*n];return[t=r[0],e=-(e=r[1])]}function I(t,e,n,i,r,a,o){var s=y(F.call(this,a));t.data([s]),E.call(t.node(),s),B(t,e,n,i,r,a,o)}function B(t,e,n,i,r,a,o){var s=o.shortening||0,l=[[0,-3.5],[10,0],[0,3.5],[0,-3.5]],c=i-e,u=r-n,d=Math.sqrt(c*c+u*u);if(0==d)var f=1,p=0;else f=c/d,p=u/d;if(i=e+(d-s-10-.1)*f,r=n+(d-s-10-.1)*p,a.URL||a.tooltip)var g=t.selectWithoutDataPropagation("g").selectWithoutDataPropagation("a"),v=g.selectWithoutDataPropagation("path"),y=g.selectWithoutDataPropagation("polygon");else v=t.selectWithoutDataPropagation("path"),y=t.selectWithoutDataPropagation("polygon");var _=h.path();_.moveTo(e,n),_.lineTo(i,r),v.attr("d",_),i=e+(d-s-10)*f,r=n+(d-s-10)*p;for(var m=0;m<l.length;m++){var w=l[m];l[m]=q(w[0],w[1],f,p)}for(m=0;m<l.length;m++){w=l[m];l[m]=[i+w[0],r+w[1]]}var x=[];for(m=0;m<l.length;m++){w=l[m];x.push(w.join(","))}var b=x.join(" ");return y.attr("points",b),this}function U(){return this._drawnEdge?(this._drawnEdge.g.remove(),this._drawnEdge=null,this):this}function R(){return this._drawnEdge?this._drawnEdge.g:d.select(null)}function F(t){for(var e="",n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];null!=t[r]&&(e+=' "'+r+'"="'+t[r]+'"')}var a="digraph {a -> b ["+e+"]}",o=this.layoutSync(a,"svg","dot"),s=(new window.DOMParser).parseFromString(o,"image/svg+xml");return d.select(document.createDocumentFragment()).append((function(){return s.documentElement})).select(".edge")}function C(t,e,n,i,r,a){var o=y(G.call(this,i,r));return t.data([o]),E.call(t.node(),o),V(t,e,n,r),this}function V(t,e,n,i,r){if(i.URL||i.tooltip)var a=t.selectWithoutDataPropagation("g").selectWithoutDataPropagation("a");else a=t;var o=a.selectAll("ellipse,polygon,path,polyline"),s=t.selectWithoutDataPropagation("text");if(0!=o.size()){var l=o.node().getBBox();l.cx=l.x+l.width/2,l.cy=l.y+l.height/2}else 0!=s.size()&&(l={x:+s.attr("x"),y:+s.attr("y"),width:0,height:0,cx:+s.attr("x"),cy:+s.attr("y")});return o.each((function(t,i){var r=d.select(this);if(r.attr("cx"))r.attr("cx",P(e)).attr("cy",P(n));else if(r.attr("points")){var a=r.attr("points").trim();r.attr("points",function(t,e,n){var i,r=(i=t.split(" ")).map((function(t){return t.split(",")}));return r=i.map((function(t){return[P(+e+ +t.split(",")[0]),P(+n+ +t.split(",")[1])]})),t=(i=r.map((function(t){return t.join(",")}))).join(" ")}(a,e-l.cx,n-l.cy))}else{var o=r.attr("d");r.attr("d",function(t,e,n){(r=t.split(/[A-Z ]/)).shift();var i=t.split(/[^[A-Z ]+/),r=(r.map((function(t){return t.split(",")})),r.map((function(t){return[P(+e+ +t.split(",")[0]),P(+n+ +t.split(",")[1])]})).map((function(t){return t.join(",")})));return i.reduce((function(t,e,n){return t.concat(e,r[n])}),[]).join("")}(o,e-l.cx,n-l.cy))}})),0!=s.size()&&s.attr("x",P(+s.attr("x")+e-l.cx)).attr("y",P(+s.attr("y")+n-l.cy)),this}function Z(){if(!this._drawnNode)return this;var t=this._drawnNode.g;return t.empty()||t.remove(),this._drawnNode=null,this}function $(){return this._drawnNode?this._drawnNode.g:d.select(null)}function G(t,e){for(var n="",i=0,r=Object.keys(e);i<r.length;i++){var a=r[i];null!=e[a]&&(n+=' "'+a+'"="'+e[a]+'"')}var o='graph {"'+t+'" ['+n+"]}",s=this.layoutSync(o,"svg","dot"),l=(new window.DOMParser).parseFromString(s,"image/svg+xml");return d.select(document.createDocumentFragment()).append((function(){return l.documentElement})).select(".node")}function H(t){self.document={},t.addEventListener("message",(function(e){var n=self["@hpcc-js/wasm"];null==n&&e.data.vizURL&&(importScripts(e.data.vizURL),(n=self["@hpcc-js/wasm"]).wasmFolder(e.data.vizURL.match(/.*\//)[0])),"version"!=e.data.type?n.graphviz.layout(e.data.dot,"svg",e.data.engine,e.data.options).then((function(n){n?t.postMessage({type:"done",svg:n}):e.data.vizURL?t.postMessage({type:"init"}):t.postMessage({type:"skip"})})).catch((function(e){t.postMessage({type:"error",error:e.message})})):n.graphvizVersion().then((function(e){t.postMessage({type:"version",version:e})}))}))}function J(){H(self)}function K(){self.onconnect=function(t){var e=t.ports[0];H(e),e.start()}}function Q(t,e){var i=this;if(this._options={useWorker:!0,useSharedWorker:!1,engine:"dot",keyMode:"title",fade:!0,tweenPaths:!0,tweenShapes:!0,convertEqualSidedPolygons:!0,tweenPrecision:1,growEnteringEdges:!0,zoom:!0,zoomScaleExtent:[.1,10],zoomTranslateExtent:[[-1/0,-1/0],[1/0,1/0]],width:null,height:null,scale:1,fit:!1},e instanceof Object)for(var r=0,a=Object.keys(e);r<a.length;r++){var o=a[r];this._options[o]=e[o]}else"boolean"==typeof e&&(this._options.useWorker=e);var l=this._options.useWorker,h=this._options.useSharedWorker;if("undefined"==typeof Worker&&(l=!1),"undefined"==typeof SharedWorker&&(h=!1),l||h){var c=d.selectAll("script").filter((function(){return"javascript/worker"==d.select(this).attr("type")||d.select(this).attr("src")&&d.select(this).attr("src").match(/.*\/@hpcc-js\/wasm/)}));0==c.size()?(console.warn('No script tag of type "javascript/worker" was found and "useWorker" is true. Not using web worker.'),l=!1,h=!1):(this._vizURL=c.attr("src"),this._vizURL||(console.warn('No "src" attribute of was found on the "javascript/worker" script tag and "useWorker" is true. Not using web worker.'),l=!1,h=!1))}if(h){var u="data:application/javascript;base64,"+btoa(H.toString()+"("+K.toString()+")()");this._worker=this._worker=new SharedWorker(u),this._workerPort=this._worker.port,this._workerPortClose=this._worker.port.close.bind(this._workerPort),this._worker.port.start(),this._workerCallbacks=[]}else if(l){var f=new Blob([H.toString()+"("+J.toString()+")()"]),g=window.URL.createObjectURL(f);this._worker=new Worker(g),this._workerPort=this._worker,this._workerPortClose=this._worker.terminate.bind(this._worker),this._workerCallbacks=[]}else s.graphvizVersion().then(function(t){i._graphvizVersion=t}.bind(this));this._selection=t,this._active=!1,this._busy=!1,this._jobs=[],this._queue=[],this._keyModes=new Set(["title","id","tag-index","index"]),this._images=[],this._translation=void 0,this._scale=void 0,this._eventTypes=["initEnd","start","layoutStart","layoutEnd","dataExtractEnd","dataProcessPass1End","dataProcessPass2End","dataProcessEnd","renderStart","renderEnd","transitionStart","transitionEnd","restoreEnd","end","zoom"],this._dispatch=n.dispatch.apply(void 0,p(this._eventTypes)),L.call(this),t.node().__graphviz__=this}function X(t,e){return d.select(t).graphviz(e)}Q.prototype=X.prototype=(u={constructor:Q,engine:function(t){return this._options.engine=t,this},addImage:function(t,e,n){return this._images.push({path:t,width:e,height:n}),this},keyMode:function(t){if(!this._keyModes.has(t))throw Error("Illegal keyMode: "+t);if(t!=this._options.keyMode&&null!=this._data)throw Error("Too late to change keyMode");return this._options.keyMode=t,this},fade:function(t){return this._options.fade=t,this},tweenPaths:function(t){return this._options.tweenPaths=t,this},tweenShapes:function(t){return this._options.tweenShapes=t,t&&(this._options.tweenPaths=!0),this},convertEqualSidedPolygons:function(t){return this._options.convertEqualSidedPolygons=t,this},tweenPrecision:function(t){return this._options.tweenPrecision=t,this},growEnteringEdges:function(t){return this._options.growEnteringEdges=t,this},zoom:function(t){return this._options.zoom=t,this._options.zoom&&!this._zoomBehavior?z.call(this):!this._options.zoom&&this._zoomBehavior&&(this._zoomSelection.on(".zoom",null),this._zoomBehavior=null),this},resetZoom:function(t){var e=this._zoomSelection;return t&&(e=e.transition(t)),e.call(this._zoomBehavior.transform,this._originalTransform),this},zoomBehavior:function(){return this._zoomBehavior||null},zoomSelection:function(){return this._zoomSelection||null},zoomScaleExtent:function(t){return this._options.zoomScaleExtent=t,this},zoomTranslateExtent:function(t){return this._options.zoomTranslateExtent=t,this},render:function(t){return this._busy?(this._queue.push(this.render.bind(this,t)),this):(this._dispatch.call("renderStart",this),this._transitionFactory?r.timeout(function(){this._transition=i.transition(this._transitionFactory()),W.call(this,t)}.bind(this),0):W.call(this,t),this)},layout:function(t,e,n,i){if(this._worker)A.call(this,{type:"layout",dot:t,engine:e,options:n},(function(t){i.call(this,t.data)}));else try{var r=this.layoutSync(t,"svg",e,n);i.call(this,{type:"done",svg:r})}catch(t){i.call(this,{type:"error",error:t.message})}},dot:function(t,e){var n=this;this._worker;var i=this._options.engine,r=this._images;this._dispatch.call("start",this),this._busy=!0,this._dispatch.call("layoutStart",this);var a={images:r};return this._worker||null!=this.layoutSync?(this.layout(t,i,a,(function(t){switch(t.type){case"error":if(!n._onerror)throw t.error.message;n._onerror(t.error);break;case"done":var i=t.svg;T.call(this,i,e)}})),this):(this._afterInit=this.dot.bind(this,t,e),this)},data:function(){return this._data||null},renderDot:function(t,e){var n=this;return this.dot(t,(function(){n.render(e)})),this},transition:function(t){return t instanceof Function?this._transitionFactory=t:this._transition=i.transition(t),this},active:function(t){var e=this._selection.selectWithoutDataPropagation("svg");return 0!=e.size()?i.active(e.node(),t):null},options:function(t){if(void 0===t)return Object.assign({},this._options);for(var e=0,n=Object.keys(t);e<n.length;e++){var i=n[e];this._options[i]=t[i]}return this},width:function(t){return this._options.width=t,this},height:function(t){return this._options.height=t,this},scale:function(t){return this._options.scale=t,this},fit:function(t){return this._options.fit=t,this},attributer:function(t){return this._attributer=t,this},on:function(t,e){return this._dispatch.on(t,e),this},onerror:function(t){return this._onerror=t,this},logEvents:function(t){for(var e=this,n=Date.now(),i={},r=this._eventTypes,a=Math.max.apply(Math,p(r.map((function(t){return t.length})))),o=function(o){var s=r[o];i[s]=[],h=e,e.on(s+".log",t?function(){var t=Date.now(),e=i[s].length;i[s].push(t);var r="";if(r+="Event ",r+=l.format(" >2")(o)+" ",r+=s+" ".repeat(a-s.length),r+=l.format(" >5")(t-n)+" ","initEnd"!=s&&(r+=l.format(" >5")(t-i.start[e])),"dataProcessEnd"==s&&(r+=" prepare                 "+l.format(" >5")(t-i.layoutEnd[e])),"renderEnd"==s&&h._transition&&(r+=" transition start margin "+l.format(" >5")(h._transition.delay()-(t-i.renderStart[e])),c=h._transition.delay(),u=h._transition.duration()),"transitionStart"==s){var d=t-i.renderStart[e];r+=" transition delay        "+l.format(" >5")(t-i.renderStart[e]),r+=" expected "+l.format(" >5")(c),r+=" diff "+l.format(" >5")(d-c)}if("transitionEnd"==s){var f=t-i.transitionStart[e];r+=" transition duration     "+l.format(" >5")(f),r+=" expected "+l.format(" >5")(u),r+=" diff "+l.format(" >5")(f-u)}console.log(r),n=t}:null)},s=0;s<r.length;s++){var h,c,u;o(s)}return this},destroy:function(){return delete this._selection.node().__graphviz__,this._worker&&this._workerPortClose(),this},drawEdge:function(t,e,n,i,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};if((r=Object.assign({},r)).style&&r.style.includes("invis"))var o=d.select(null);else{var s=this._selection,l=s.selectWithoutDataPropagation("svg"),h=l.selectWithoutDataPropagation("g"),c=F.call(this,r),u=y(c);o=h.append("g").data([u]);E.call(o.node(),u),I.call(this,o,t,e,n,i,r,a)}return this._drawnEdge={g:o,x1:t,y1:e,x2:n,y2:i,attributes:r},this},updateDrawnEdge:function(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};if(!this._drawnEdge)throw Error("No edge has been drawn");var o=this._drawnEdge.g;if(r=Object.assign(this._drawnEdge.attributes,r),this._drawnEdge.x1=t,this._drawnEdge.y1=e,this._drawnEdge.x2=n,this._drawnEdge.y2=i,o.empty()&&(!r.style||!r.style.includes("invis"))){var s=this._selection,l=s.selectWithoutDataPropagation("svg"),h=l.selectWithoutDataPropagation("g");o=h.append("g");this._drawnEdge.g=o}return o.empty()||I.call(this,o,t,e,n,i,r,a),this},moveDrawnEdgeEndPoint:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this._drawnEdge)throw Error("No edge has been drawn");var i=this._drawnEdge.g,r=this._drawnEdge.x1,a=this._drawnEdge.y1,o=this._drawnEdge.attributes;return this._drawnEdge.x2=t,this._drawnEdge.y2=e,B(i,r,a,t,e,o,n),this},insertDrawnEdge:function(t){if(!this._drawnEdge)throw Error("No edge has been drawn");var e=this._drawnEdge.g;if(e.empty())return this;this._drawnEdge.attributes,e.selectWithoutDataPropagation("title").text(t);var n=this._selection.selectWithoutDataPropagation("svg").selectWithoutDataPropagation("g"),i=n.datum(),r=this._extractData(e,i.children.length,n.datum());return i.children.push(r),x(e,r),this._drawnEdge=null,this},removeDrawnEdge:U},f(u,"removeDrawnEdge",U),f(u,"drawnEdgeSelection",R),f(u,"drawnEdgeSelection",R),f(u,"drawNode",(function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if((i=Object.assign({},i)).style&&i.style.includes("invis"))var a=d.select(null);else{var o=this._selection,s=o.selectWithoutDataPropagation("svg"),l=s.selectWithoutDataPropagation("g"),h=G.call(this,n,i),c=y(h);a=l.append("g").data([c]);E.call(a.node(),c),C.call(this,a,t,e,n,i,r)}return this._drawnNode={g:a,nodeId:n,x:t,y:e,attributes:i},this})),f(u,"updateDrawnNode",(function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(!this._drawnNode)throw Error("No node has been drawn");var a=this._drawnNode.g;if(null==n&&(n=this._drawnNode.nodeId),i=Object.assign(this._drawnNode.attributes,i),this._drawnNode.nodeId=n,this._drawnNode.x=t,this._drawnNode.y=e,a.empty()&&(!i.style||!i.style.includes("invis"))){var o=this._selection,s=o.selectWithoutDataPropagation("svg"),l=s.selectWithoutDataPropagation("g");a=l.append("g");this._drawnNode.g=a}return a.empty()||C.call(this,a,t,e,n,i,r),this})),f(u,"moveDrawnNode",(function(t,e){if(!this._drawnNode)throw Error("No node has been drawn");var n=this._drawnNode.g,i=this._drawnNode.attributes;return this._drawnNode.x=t,this._drawnNode.y=e,n.empty()||V(n,t,e,i),this})),f(u,"insertDrawnNode",(function(t){if(!this._drawnNode)throw Error("No node has been drawn");null==t&&(t=this._drawnNode.nodeId);var e=this._drawnNode.g;if(e.empty())return this;var n=this._drawnNode.attributes;if(e.selectWithoutDataPropagation("title").text(t),n.URL||n.tooltip){var i=e.selectWithoutDataPropagation("g").selectWithoutDataPropagation("a");i.selectWithoutDataPropagation("ellipse,polygon,path,polyline");var r=i.selectWithoutDataPropagation("text")}else{e.selectWithoutDataPropagation("ellipse,polygon,path,polyline");r=e.selectWithoutDataPropagation("text")}r.text(n.label||t);var a=this._selection.selectWithoutDataPropagation("svg").selectWithoutDataPropagation("g"),o=a.datum(),s=this._extractData(e,o.children.length,a.datum());return o.children.push(s),x(e,s),this._drawnNode=null,this})),f(u,"removeDrawnNode",Z),f(u,"removeDrawnNode",Z),f(u,"drawnNodeSelection",$),f(u,"drawnNodeSelection",$),f(u,"graphvizVersion",(function(){return this._graphvizVersion})),u),e.selection.prototype.graphviz=function(t){var e=this.node().__graphviz__;return e?(e.options(t),r.timeout(function(){e._dispatch.call("initEnd",this)}.bind(this),0)):e=new Q(this,t),e},e.selection.prototype.selectWithoutDataPropagation=function(t){return d.select(this.size()>0?this.node().querySelector(t):null)},t.graphviz=X,Object.defineProperty(t,"__esModule",{value:!0})}));